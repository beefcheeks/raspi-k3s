namespace: home-assistant

resources:
- blueprints.yaml # Only needed if using custom blueprints
- configuration.yaml
- ingress.yaml
- pvc.yaml
- service.yaml
- statefulset.yaml

images:
  - name: ghcr.io/home-assistant/home-assistant
    newTag: "2023.12.3"

patches:
  # Add configuration to support ingress
  - target:
      kind: ConfigMap
      name: home-assistant
    path: patches/configuration.yaml
  # Add custom blueprints to home-assistant
  - target:
      kind: StatefulSet
      name: home-assistant
    path: patches/blueprints.yaml
  # Ensure route advertisements update the routing table
  - target:
      kind: StatefulSet
      name: home-assistant
    path: patches/route-manager.yaml
  # Enable external network interface via multus
  - target:
      kind: StatefulSet
      name: home-assistant
    patch: |-
      # Patch home-assistant StatefulSet to use multus interface so hostNetwork: true is not needed
      apiVersion: apps/v1
      kind: StatefulSet
      metadata:
        name: ignored
      spec:
        template:
          metadata:
            annotations:
              k8s.v1.cni.cncf.io/networks: '[{"name":"macvlan-conf","namespace":"kube-system"}]'
  # Ensure DNS routes correctly while using multus
  # Always put this last so it becomes the first initContainer to run
  - target:
      kind: StatefulSet
      name: home-assistant
    path: ../multus/patches/dns-route.yaml
